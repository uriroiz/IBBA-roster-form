<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IBBA Team Roster Submission Form - Pixellot Advantage</title>
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script>
        (function(){
            emailjs.init("_r4Y7hg0AGi5DhIcF");
            window.emailjsReady = true;
        })();
    </script>
    <style>
        /* Include your existing CSS here (unchanged) */
    </style>
</head>
<body>
    <div class="container">
        <h1>üèÄ IBBA Team Roster Submission</h1>
        <p class="subtitle">Official roster form for IBBA league teams ‚Ä¢ Powered by Pixellot Advantage</p>

        <div class="version-info">
            <span class="version">Version 3.2.7</span>
            <span class="date">Updated: August 2025</span>
        </div>

        <form id="rosterForm">
            <!-- Form sections unchanged -->

            <div class="buttons">
                <button type="submit" class="btn btn-primary">üöÄ Submit Roster</button>
            </div>

            <div class="loading" id="loading">
                üîÑ Submitting your roster...
            </div>

            <div class="success-message" id="success">
                ‚úÖ Roster submitted successfully! Email sent to pixellotibba@gmail.com and CSV backup saved.
            </div>
        </form>
    </div>

    <script>
        window.EmailJSConfig = {
            publicKey: "_r4Y7hg0AGi5DhIcF",
            serviceId: "service_4bdvcf9",
            templateId: "template_6o8secn"
        };

        document.getElementById('rosterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            document.getElementById('loading').style.display = 'block';

            const formData = new FormData(this);
            const teamName = formData.get('teamName');
            const league = formData.get('league');
            const submitterName = formData.get('submitterName');
            const submitterEmail = formData.get('submitterEmail');

            if (!teamName || !league || !submitterName || !submitterEmail) {
                alert('Please fill in all required team and contact information.');
                document.getElementById('loading').style.display = 'none';
                return;
            }

            let hasPlayers = false;
            for (let i = 1; i <= 16; i++) {
                if (formData.get(`player${i}_jersey`) && formData.get(`player${i}_first`) && formData.get(`player${i}_last`)) {
                    hasPlayers = true;
                    break;
                }
            }

            if (!hasPlayers) {
                alert('Please add at least one complete player.');
                document.getElementById('loading').style.display = 'none';
                return;
            }

            const leagueMapping = {
                '◊ú◊ê◊ï◊û◊ô◊™ ◊í◊ë◊®◊ô◊ù': 'National Men',
                '◊¢◊ú ◊†◊©◊ô◊ù': 'Premier Women',
                '◊ú◊ê◊ï◊û◊ô◊™ ◊†◊©◊ô◊ù': 'National Women',
                '◊†◊ï◊¢◊® ◊¢◊ú ◊ë◊†◊ô◊ù': 'Youth Premier Boys',
                '◊†◊¢◊®◊ï◊™ ◊ê ◊¢◊ú ◊ë◊†◊ï◊™': 'Junior A Premier Girls'
            };

            const rosterData = {
                teamName,
                league,
                leagueEnglish: leagueMapping[league] || 'Unknown League',
                submitterName,
                submitterEmail,
                players: [],
                staff: []
            };

            for (let i = 1; i <= 16; i++) {
                const player = {
                    jersey: formData.get(`player${i}_jersey`),
                    firstName: formData.get(`player${i}_first`),
                    lastName: formData.get(`player${i}_last`),
                    position: formData.get(`player${i}_position`),
                    email: formData.get(`player${i}_email`)
                };
                if (player.jersey && player.firstName && player.lastName) {
                    rosterData.players.push(player);
                }
            }

            const staffKeys = [
                { key: 'coach', role: 'Head Coach' },
                { key: 'asst1', role: 'Assistant Coach 1' },
                { key: 'asst2', role: 'Assistant Coach 2' },
                { key: 'asst3', role: 'Assistant Coach 3' },
                { key: 'gm', role: 'General Manager' }
            ];

            staffKeys.forEach(staff => {
                const first = formData.get(`${staff.key}_first`);
                const last = formData.get(`${staff.key}_last`);
                const email = formData.get(`${staff.key}_email`);
                if (first || last) {
                    rosterData.staff.push({ firstName: first, lastName: last, email, role: staff.role });
                }
            });

            let rosterSummary = `IBBA TEAM ROSTER SUBMISSION\n`;
            rosterSummary += `==============================\n`;
            rosterSummary += `Team: ${teamName}\n`;
            rosterSummary += `League: ${league} (${rosterData.leagueEnglish})\n`;
            rosterSummary += `Submitted by: ${submitterName}\n`;
            rosterSummary += `Email: ${submitterEmail}\n`;
            rosterSummary += `Date: ${new Date().toLocaleString()}\n`;
            rosterSummary += `Version: 3.2.7\n\n`;

            rosterSummary += `PLAYERS (${rosterData.players.length}):\n`;
            rosterData.players.forEach(p => {
                rosterSummary += `#${p.jersey} - ${p.firstName} ${p.lastName}`;
                if (p.position) rosterSummary += ` (${p.position})`;
                if (p.email) rosterSummary += ` - ${p.email}`;
                rosterSummary += `\n`;
            });

            rosterSummary += `\nCOACHING STAFF (${rosterData.staff.length}):\n`;
            rosterData.staff.forEach(s => {
                rosterSummary += `${s.role}: ${s.firstName} ${s.lastName}`;
                if (s.email) rosterSummary += ` - ${s.email}`;
                rosterSummary += `\n`;
            });

            const emailParams = {
                team_name: teamName,
                league: rosterData.leagueEnglish,
                submitter_name: submitterName,
                submitter_email: submitterEmail,
                roster_data: rosterSummary
            };

            emailjs.send(EmailJSConfig.serviceId, EmailJSConfig.templateId, emailParams)
                .then(res => {
                    console.log("‚úÖ Email sent", res);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('success').style.display = 'block';
                    alert('‚úÖ Email sent successfully!');
                })
                .catch(err => {
                    console.error("‚ùå Email failed", err);
                    document.getElementById('loading').style.display = 'none';
                    alert('‚ùå Email sending failed. A CSV will be downloaded. Please email it manually.');
                });
        });
    </script>
</body>
</html>
